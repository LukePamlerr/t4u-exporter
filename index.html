<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Rich Presence Controller</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #1a1a1a;
            color: #e5e7eb;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .container {
            max-width: 36rem;
            width: 100%;
            padding: 1.5rem;
        }
        .preview-box {
            background-color: #2d3748;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        .error {
            color: #ef4444;
            font-size: 0.875rem;
        }
        input, button {
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-2xl font-bold mb-6 text-center">Discord Rich Presence Controller</h1>
        
        <div class="preview-box">
            <h2 class="text-lg font-semibold mb-2">Preview</h2>
            <p id="preview-details" class="text-sm">Details: <span>meana.xyz</span></p>
            <p id="preview-state" class="text-sm">State: <span>Playing</span></p>
            <p id="preview-timer" class="text-sm">Timer: <span>Not set</span></p>
            <p id="preview-large-image" class="text-sm">Large Image: <span>img_3056 (Numbani)</span></p>
            <p id="preview-small-image" class="text-sm">Small Image: <span>img_3056 (Rogue - Level 100)</span></p>
            <p id="preview-party" class="text-sm">Party: <span>1/5 (ID: ae488379-351d-4a4f-ad32-2b9b01c91657)</span></p>
            <p id="preview-join" class="text-sm">Join Secret: <span>MTI4NzM0OjFpMmhuZToxMjMxMjM=</span></p>
            <p id="preview-status" class="text-sm text-red-400">Status: Disconnected</p>
        </div>

        <form id="rpc-form" class="space-y-4">
            <div>
                <label for="details" class="block text-sm font-medium">Details</label>
                <input type="text" id="details" class="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" value="meana.xyz">
            </div>
            <div>
                <label for="state" class="block text-sm font-medium">State</label>
                <input type="text" id="state" class="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" value="Playing">
            </div>
            <div>
                <label for="large-image" class="block text-sm font-medium">Large Image Key</label>
                <input type="text" id="large-image" class="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" value="img_3056">
            </div>
            <div>
                <label for="large-image-text" class="block text-sm font-medium">Large Image Text</label>
                <input type="text" id="large-image-text" class="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" value="Numbani">
            </div>
            <div>
                <label for="small-image" class="block text-sm font-medium">Small Image Key</label>
                <input type="text" id="small-image" class="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" value="img_3056">
            </div>
            <div>
                <label for="small-image-text" class="block text-sm font-medium">Small Image Text</label>
                <input type="text" id="small-image-text" class="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" value="Rogue - Level 100">
            </div>
            <div>
                <label for="party-id" class="block text-sm font-medium">Party ID</label>
                <input type="text" id="party-id" class="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" value="ae488379-351d-4a4f-ad32-2b9b01c91657">
            </div>
            <div>
                <label for="party-size" class="block text-sm font-medium">Party Size</label>
                <input type="number" id="party-size" class="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" value="1" min="1">
            </div>
            <div>
                <label for="party-max" class="block text-sm font-medium">Party Max</label>
                <input type="number" id="party-max" class="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" value="5" min="1">
            </div>
            <div>
                <label for="join-secret" class="block text-sm font-medium">Join Secret</label>
                <input type="text" id="join-secret" class="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" value="MTI4NzM0OjFpMmhuZToxMjMxMjM=">
            </div>
            <div>
                <label for="timer" class="block text-sm font-medium">Timer (seconds from now)</label>
                <input type="number" id="timer" class="mt-1 w-full p-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., 3600">
            </div>
            <button type="submit" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">Update Presence</button>
        </form>
        <p id="error" class="error mt-4 hidden"></p>
    </div>

    <script>
        const ws = new WebSocket('ws://localhost:8080');
        const form = document.getElementById('rpc-form');
        const error = document.getElementById('error');
        const preview = {
            details: document.getElementById('preview-details').querySelector('span'),
            state: document.getElementById('preview-state').querySelector('span'),
            timer: document.getElementById('preview-timer').querySelector('span'),
            largeImage: document.getElementById('preview-large-image').querySelector('span'),
            smallImage: document.getElementById('preview-small-image').querySelector('span'),
            party: document.getElementById('preview-party').querySelector('span'),
            join: document.getElementById('preview-join').querySelector('span'),
            status: document.getElementById('preview-status')
        };

        ws.onopen = () => {
            preview.status.textContent = 'Connected to server';
            preview.status.classList.replace('text-red-400', 'text-green-400');
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'error') {
                error.textContent = data.message;
                error.classList.remove('hidden');
            } else if (data.type === 'update') {
                preview.details.textContent = data.details || 'None';
                preview.state.textContent = data.state || 'None';
                preview.timer.textContent = data.timer ? `Ends in ${Math.round((data.timer - Date.now() / 1000))}s` : 'Not set';
                preview.largeImage.textContent = data.largeImage ? `${data.largeImage} (${data.largeImageText || 'No text'})` : 'None';
                preview.smallImage.textContent = data.smallImage ? `${data.smallImage} (${data.smallImageText || 'No text'})` : 'None';
                preview.party.textContent = data.partyId ? `${data.partySize}/${data.partyMax} (ID: ${data.partyId})` : 'None';
                preview.join.textContent = data.joinSecret || 'None';
                preview.status.textContent = 'Presence updated';
                error.classList.add('hidden');
            }
        };

        ws.onclose = () => {
            preview.status.textContent = 'Disconnected from server';
            preview.status.classList.replace('text-green-400', 'text-red-400');
            error.textContent = 'Server disconnected. Please check the backend.';
            error.classList.remove('hidden');
        };

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const presence = {
                details: document.getElementById('details').value,
                state: document.getElementById('state').value,
                largeImage: document.getElementById('large-image').value,
                largeImageText: document.getElementById('large-image-text').value,
                smallImage: document.getElementById('small-image').value,
                smallImageText: document.getElementById('small-image-text').value,
                partyId: document.getElementById('party-id').value,
                partySize: parseInt(document.getElementById('party-size').value) || 0,
                partyMax: parseInt(document.getElementById('party-max').value) || 0,
                joinSecret: document.getElementById('join-secret').value,
                timer: parseInt(document.getElementById('timer').value) || 0
            };
            if (ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify(presence));
            } else {
                error.textContent = 'Not connected to server';
                error.classList.remove('hidden');
            }
        });

        // Update timer preview every second
        setInterval(() => {
            if (preview.timer.textContent !== 'Not set') {
                const seconds = parseInt(preview.timer.textContent.match(/\d+/)?.[0] || 0);
                if (seconds > 0) {
                    preview.timer.textContent = `Ends in ${seconds - 1}s`;
                } else {
                    preview.timer.textContent = 'Expired';
                }
            }
        }, 1000);
    </script>
</body>
</html>
